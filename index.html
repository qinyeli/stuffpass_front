<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Recent Contact List</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
</head>

<body>
  <div id="content"></div>
    <script type="text/babel">
		var socket = io();
		socket.emit("myID", "Sindy Li");

		var Contact = React.createClass({
			render: function() {
				return (
					<div>
					  {this.props.contactName}
					  <span> is </span>
						{this.props.contactStatus}
					</div>
				);
			} // render
		}); // Contact

		var RecentContactList = React.createClass({
			render: function() {
				var contactNodes = this.props.data.map(function(contact) {
					return (
					  <Contact contactName={contact.contactName} contactStatus={contact.contactStatus} key={contact.id} />
					);
				});
				return (
					<div>
						<h2>Contact List</h2>
					  {contactNodes}
					</div>
				);
			} // render
		}); // RecentContactList

		var RecentContactBox = React.createClass({
			getInitialState: function() {
				return {dataState: [{	id:0, contactName:"No one", contactStatus: "online"}] }
				//This means I set the initial state of dataState to the prop data
			},

			componentDidMount: function() {
				var _this = this;
				socket.on("initialStatus", function(contactStatus) {
					console.log("Got the initial status");
					_this.setState({dataState: contactStatus});
				}).on("updataStatus", function(contactStatus) {
					console.log("Got update status");
					_this.setState({dataState: contactStatus});
				});
			}, // componentDidMount

			render: function() {
				return (
					<div>
						<RecentContactList data = {this.state.dataState}/>
					</div>
				);
			} // render
		}); // RecentContacBox

		ReactDOM.render(
			<RecentContactBox/>,
			document.getElementById('content')
		); // render
    </script>
</body>
</html>
